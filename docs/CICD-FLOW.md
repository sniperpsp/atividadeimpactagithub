# ğŸ”„ CI/CD Pipeline Flow - QuickOrder Infrastructure

## Fluxo Completo de Deploy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DEVELOPER WORKFLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Developer                    GitHub                      AWS
       â”‚                           â”‚                          â”‚
       â”‚  1. Create Feature Branch â”‚                          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚  2. Make Changes          â”‚                          â”‚
       â”‚     (terraform/*.tf)      â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚  3. Push Branch           â”‚                          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚  4. Create Pull Request   â”‚                          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚  ğŸ”„ TERRAFORM PLAN       â”‚
       â”‚                           â”‚  â”œâ”€ Validate             â”‚
       â”‚                           â”‚  â”œâ”€ Format Check         â”‚
       â”‚                           â”‚  â”œâ”€ Security Scan        â”‚
       â”‚                           â”‚  â”‚  â”œâ”€ Checkov           â”‚
       â”‚                           â”‚  â”‚  â”œâ”€ tfsec             â”‚
       â”‚                           â”‚  â”‚  â””â”€ Trivy             â”‚
       â”‚                           â”‚  â”œâ”€ Terraform Plan       â”‚
       â”‚                           â”‚  â””â”€ Cost Estimation      â”‚
       â”‚                           â”‚                          â”‚
       â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  ğŸ’¬ Comment on PR        â”‚
       â”‚     - Plan output          â”‚                          â”‚
       â”‚     - Security findings    â”‚                          â”‚
       â”‚     - Cost estimate        â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚  5. Code Review           â”‚                          â”‚
       â”‚  6. Approve PR            â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚  7. Merge to Main         â”‚                          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚  ğŸš€ TERRAFORM APPLY      â”‚
       â”‚                           â”‚  â”œâ”€ Pre-checks           â”‚
       â”‚                           â”‚  â”œâ”€ Terraform Plan       â”‚
       â”‚                           â”‚  â”œâ”€ Save Plan Artifact   â”‚
       â”‚                           â”‚  â”‚                        â”‚
       â”‚                           â”‚  â¸ï¸  WAIT FOR APPROVAL   â”‚
       â”‚                           â”‚  â”‚                        â”‚
       â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  ğŸ”” Approval Required    â”‚
       â”‚                           â”‚                          â”‚
       â”‚  8. Review & Approve      â”‚                          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚  â”œâ”€ Terraform Apply      â”‚
       â”‚                           â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Create Resources
       â”‚                           â”‚  â”‚  â”‚                   â”‚ - VPC
       â”‚                           â”‚  â”‚  â”‚                   â”‚ - EC2
       â”‚                           â”‚  â”‚  â”‚                   â”‚ - RDS
       â”‚                           â”‚  â”‚  â”‚                   â”‚ - EKS
       â”‚                           â”‚  â”‚  â”‚                   â”‚ - etc.
       â”‚                           â”‚  â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                           â”‚  â”‚                        â”‚
       â”‚                           â”‚  â”œâ”€ Post-Deploy Validationâ”‚
       â”‚                           â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Verify Resources
       â”‚                           â”‚  â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                           â”‚  â”‚                        â”‚
       â”‚                           â”‚  â””â”€ Send Notifications   â”‚
       â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  âœ… Deploy Success       â”‚
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚                          â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SCHEDULED WORKFLOWS                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â° Daily (3h UTC)              GitHub                      AWS
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚  ğŸ”’ SECURITY SCAN        â”‚
       â”‚                           â”‚  â”œâ”€ Checkov              â”‚
       â”‚                           â”‚  â”œâ”€ tfsec                â”‚
       â”‚                           â”‚  â”œâ”€ Trivy                â”‚
       â”‚                           â”‚  â”œâ”€ Compliance Check     â”‚
       â”‚                           â”‚  â”‚                        â”‚
       â”‚                           â”‚  â””â”€ Upload to Security Tabâ”‚
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚  âŒ If Failures:         â”‚
       â”‚                           â”‚  â””â”€ Create Issue         â”‚
       â”‚                           â”‚                          â”‚

    â° Weekly (Mon 9h UTC)         GitHub                      AWS
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚  ğŸ’° COST ESTIMATION      â”‚
       â”‚                           â”‚  â”œâ”€ Infracost Breakdown  â”‚
       â”‚                           â”‚  â”œâ”€ Compare with Baselineâ”‚
       â”‚                           â”‚  â”œâ”€ Generate Report      â”‚
       â”‚                           â”‚  â”‚                        â”‚
       â”‚                           â”‚  â””â”€ Check Threshold      â”‚
       â”‚                           â”‚     (>$150/month)        â”‚
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚  âš ï¸  If Exceeded:        â”‚
       â”‚                           â”‚  â””â”€ Create Alert Issue   â”‚
       â”‚                           â”‚                          â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MANUAL WORKFLOWS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Developer                    GitHub                      AWS
       â”‚                           â”‚                          â”‚
       â”‚  ğŸ—‘ï¸  TERRAFORM DESTROY    â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚  1. Trigger Workflow      â”‚                          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
       â”‚     - Environment: prod   â”‚                          â”‚
       â”‚     - Confirmation: DESTROYâ”‚                         â”‚
       â”‚     - Reason: "..."       â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚  â”œâ”€ Validate Input       â”‚
       â”‚                           â”‚  â”œâ”€ Backup State         â”‚
       â”‚                           â”‚  â”œâ”€ Destroy Plan         â”‚
       â”‚                           â”‚  â”‚                        â”‚
       â”‚                           â”‚  â¸ï¸  WAIT FOR APPROVAL   â”‚
       â”‚                           â”‚  â”‚  (Double Approval)    â”‚
       â”‚                           â”‚                          â”‚
       â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  ğŸ”” Approval Required    â”‚
       â”‚                           â”‚                          â”‚
       â”‚  2. Review & Approve      â”‚                          â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
       â”‚                           â”‚                          â”‚
       â”‚                           â”‚  â”œâ”€ Execute Destroy      â”‚
       â”‚                           â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ Delete Resources
       â”‚                           â”‚  â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                           â”‚  â”‚                        â”‚
       â”‚                           â”‚  â””â”€ Verify Destruction   â”‚
       â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  âœ… Destroy Complete     â”‚
       â”‚                           â”‚                          â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ARTIFACTS & OUTPUTS                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“¦ Artifacts Generated:
   â”œâ”€ Terraform Plans (30 days retention)
   â”œâ”€ Apply Outputs (90 days retention)
   â”œâ”€ Terraform Outputs (90 days retention)
   â”œâ”€ Security Scan Results (30 days retention)
   â”œâ”€ Cost Reports (90 days retention)
   â””â”€ State Backups (365 days retention)

ğŸ“Š GitHub Integrations:
   â”œâ”€ PR Comments (Plan, Security, Cost)
   â”œâ”€ Security Tab (SARIF uploads)
   â”œâ”€ Issues (Auto-created on failures)
   â””â”€ Workflow Summaries

ğŸ”” Notifications:
   â”œâ”€ Deployment Success/Failure
   â”œâ”€ Security Findings
   â”œâ”€ Cost Alerts
   â””â”€ Approval Requests

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SECURITY & COMPLIANCE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”’ Security Layers:
   â”œâ”€ GitHub Secrets (Encrypted at rest)
   â”œâ”€ Environment Protection Rules
   â”œâ”€ Required Approvals
   â”œâ”€ OIDC Authentication (Future)
   â””â”€ Audit Logs

âœ… Compliance Checks:
   â”œâ”€ CIS AWS Foundations Benchmark
   â”œâ”€ AWS Best Practices
   â”œâ”€ Terraform Best Practices
   â””â”€ Custom Compliance Rules

ğŸ›¡ï¸ Security Scanning:
   â”œâ”€ Checkov (Policy as Code)
   â”œâ”€ tfsec (Static Analysis)
   â”œâ”€ Trivy (Vulnerability Scanning)
   â””â”€ Terraform Compliance

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ROLLBACK STRATEGY                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”„ Rollback Options:

1. Git Revert (Recommended):
   git revert <commit-hash>
   git push origin main
   â†’ Triggers automatic deploy of previous state

2. Manual Rollback:
   Actions â†’ Terraform Destroy â†’ Run workflow
   â†’ Destroy problematic resources
   â†’ Re-deploy from previous commit

3. State Rollback (Emergency):
   Download state backup from artifacts
   â†’ Restore to S3
   â†’ Run terraform apply

âš ï¸  Always prefer Git revert for traceability
